# Tests gen with a custom function that has multiple calls to mock.Expect.
# golden files are under testdata

replace ../../../.. $MUT go.mod

vermockgen

cmpenv stdout testdata/stdout

cmpenv stderr testdata/stderr

cmp vermock_gen.go testdata/vermock_gen.go

-- testdata/stdout --
-- testdata/stderr --
vermockgen: example.com: wrote $WORK/vermock_gen.go
-- cache.go --
package cache

type Cache interface {
	Put(key string, value any) error
	Get(key string) (value any, ok bool)
	Delete(string)
	Load(...string)
}
-- go.mod --
module example.com

go 1.20

require github.com/Versent/go-vermock v0.0.0-00010101000000-000000000000

replace github.com/Versent/go-vermock => ../../../..
-- mock.go --
//go:build vermockstub

package cache

import (
	mock "github.com/Versent/go-vermock"
)

type mockCache struct {
	Cache
}

func Custom(delegate func(key string)) func(*mockCache) {
	mock.Expect[mockCache]("Get", delegate)
	return mock.Expect[mockCache]("Delete", delegate)
}
-- testdata/vermock_gen.go --
// Code generated by vermockgen. DO NOT EDIT.

//go:generate go run -mod=mod github.com/Versent/go-vermock/cmd/vermockgen
//go:build !vermockstub
// +build !vermockstub

package cache

import (
	testing "testing"
)

import (
	mock "github.com/Versent/go-vermock"
)

var _ Cache = (*mockCache)(nil)

func ExpectDelete(delegate func(_ testing.TB, v0 string)) func(*mockCache) {
	return mock.Expect[mockCache]("Delete", delegate)
}

func ExpectManyDelete(delegate func(_ testing.TB, _ mock.CallCount, v0 string)) func(*mockCache) {
	return mock.ExpectMany[mockCache]("Delete", delegate)
}

func (m *mockCache) Delete(v0 string) {
	mock.Call0(m, "Delete", v0)
}

func ExpectGet(delegate func(_ testing.TB, key string) (value any, ok bool)) func(*mockCache) {
	return mock.Expect[mockCache]("Get", delegate)
}

func ExpectManyGet(delegate func(_ testing.TB, _ mock.CallCount, key string) (value any, ok bool)) func(*mockCache) {
	return mock.ExpectMany[mockCache]("Get", delegate)
}

func (m *mockCache) Get(key string) (value any, ok bool) {
	return mock.Call2[any, bool](m, "Get", key)
}

func ExpectLoad(delegate func(_ testing.TB, v0 []string)) func(*mockCache) {
	return mock.Expect[mockCache]("Load", delegate)
}

func ExpectManyLoad(delegate func(_ testing.TB, _ mock.CallCount, v0 []string)) func(*mockCache) {
	return mock.ExpectMany[mockCache]("Load", delegate)
}

func (m *mockCache) Load(v0 ...string) {
	mock.Call0(m, "Load", v0)
}

func ExpectPut(delegate func(_ testing.TB, key string, value any) error) func(*mockCache) {
	return mock.Expect[mockCache]("Put", delegate)
}

func ExpectManyPut(delegate func(_ testing.TB, _ mock.CallCount, key string, value any) error) func(*mockCache) {
	return mock.ExpectMany[mockCache]("Put", delegate)
}

func (m *mockCache) Put(key string, value any) error {
	return mock.Call1[error](m, "Put", key, value)
}

type mockCache struct {
	_ byte // prevent zero-size struct
}

func Custom(delegate func(key string)) func(*mockCache) {
	mock.Expect[mockCache]("Get", delegate)
	return mock.Expect[mockCache]("Delete", delegate)
}
